---
title: 滑动加载
abbrlink: d9ac2aad
date: 2019-06-28 21:01:40
---

###滑动加载

```vue
<template>
  <div>
    <ul>
      <li v-for="item in newslist">
        <h2>{{item.num}}</h2>
      </li>
    </ul>
    <div v-show="change">到底部了</div>
  </div>
</template>
<script>
import axios from "axios"
export default {
    name:'numbers',
    data(){
        return{
            oneNews:'',
            newslist:[],
            change:false,
        }
    },
    mounted() {  
 
        axios({
      url: "/api/addnums",
      method: "get",
      data: ''
    }).then(res => {
      if (res.data.code == 200) {
        this.oneNews = res.data.oneNews;
        this.oneNews.forEach((obj,index)=>{
            if(index<5){
                this.newslist.push(this.oneNews.shift());
            }
        })
      } 
    });
    this.$nextTick(function () {
      window.addEventListener('scroll', this.onScroll)
    })  
    },
    methods: {
    // 获取滚动条当前的位置
        
    getScrollTop () {
      var scrollTop = 0
      if (document.documentElement && document.documentElement.scrollTop) {
        scrollTop = document.documentElement.scrollTop
      } else if (document.body) {
        scrollTop = document.body.scrollTop
      }
      return scrollTop
    },
    // 获取当前可视范围的高度
    getClientHeight () {
      var clientHeight = 0
      if (document.body.clientHeight && document.documentElement.clientHeight) {
        clientHeight = Math.min(document.body.clientHeight, document.documentElement.clientHeight)
      } else {
        clientHeight = Math.max(document.body.clientHeight, document.documentElement.clientHeight)
      }
      return clientHeight
    },

    // 获取文档完整的高度
    getScrollHeight () {
      return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight)
    },
    // 滚动事件触发下拉加载
    onScroll () {
      if (this.getScrollHeight() - this.getClientHeight() - this.getScrollTop() <= 0) {
       for (var i = 0; i <5;i++) {
           if(this.oneNews.length>0){
               this.newslist.push(this.oneNews.shift())
           }else{
               this.change=true
               return
           }
       }
      }
    },
}
}
</script>


```

